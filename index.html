<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSC/RRB Style Exam</title>
    <style>
        /* --- CBT STYLE LAYOUT --- */
        :root {
            --header-height: 60px;
            --sidebar-width: 280px;
            --ssc-green: #28a745;   /* Answered */
            --ssc-red: #dc3545;     /* Not Answered */
            --ssc-purple: #6f42c1;  /* Review */
            --ssc-grey: #e9ecef;    /* Not Visited */
        }

        body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; height: 100vh; overflow: hidden; }

        /* HEADER */
        header {
            height: var(--header-height);
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        .timer { font-size: 1.2rem; font-weight: bold; background: black; padding: 5px 15px; border-radius: 4px; border: 1px solid white;}

        /* MAIN LAYOUT */
        .main-container {
            display: flex;
            height: calc(100vh - var(--header-height));
        }

        /* LEFT SIDE: QUESTION AREA */
        .question-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
            border-right: 2px solid #ddd;
        }
        .q-header { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; font-size: 1.1rem; }
        .q-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }
        
        /* OPTIONS (RADIO BUTTONS) */
        .options-list { list-style: none; padding: 0; }
        .options-list li { margin-bottom: 15px; }
        .options-list label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            transition: 0.2s;
        }
        .options-list label:hover { background: #f0f8ff; }
        .options-list input[type="radio"] { margin-right: 15px; transform: scale(1.3); }

        /* BUTTON FOOTER */
        .action-buttons {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn { padding: 10px 15px; border: none; cursor: pointer; color: white; border-radius: 4px; font-weight: bold; }
        .btn-save { background: var(--ssc-green); }
        .btn-review { background: var(--ssc-purple); }
        .btn-clear { background: #ffc107; color: black; }
        .btn-prev { background: #6c757d; }
        .btn-submit { background: #0056b3; margin-left: auto; }

        /* RIGHT SIDE: PALETTE */
        .sidebar {
            width: var(--sidebar-width);
            background: #f8f9fa;
            padding: 10px;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #ccc;
        }
        .palette-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
        }
        .palette-item {
            height: 40px;
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #ccc;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        /* Palette Colors */
        .p-answered { background: var(--ssc-green); color: white; border: none; clip-path: polygon(0% 0%, 100% 0%, 100% 85%, 50% 100%, 0% 85%); border-radius: 0; }
        .p-not_answered { background: var(--ssc-red); color: white; border: none; clip-path: polygon(0% 0%, 100% 0%, 100% 85%, 50% 100%, 0% 85%); border-radius: 0; }
        .p-review { background: var(--ssc-purple); color: white; border-radius: 50%; }
        .p-current { border: 2px solid blue; }

        /* RESULT OVERLAY */
        #result-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .hidden { display: none; }
        table { border-collapse: collapse; margin: 20px 0; width: 80%; max-width: 500px; }
        td, th { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>

<header>
    <div>SSC/RRB Mock Test</div>
    <div class="timer">Time Left: <span id="timer">00:00</span></div>
</header>

<div class="main-container" id="quiz-interface">
    <div class="question-area">
        <div class="q-header">
            Question No. <span id="q-number">1</span>
        </div>
        <div id="q-text" class="q-text">Loading...</div>
        
        <ul class="options-list" id="options-container"></ul>

        <div class="action-buttons">
            <button class="btn btn-review" onclick="markReview()">Mark for Review</button>
            <button class="btn btn-clear" onclick="clearResponse()">Clear Response</button>
            <button class="btn btn-prev" onclick="changeQuestion(-1)">Previous</button>
            <button class="btn btn-save" onclick="saveAndNext()">Save & Next</button>
            <button class="btn btn-submit" onclick="submitQuiz()">Submit Test</button>
        </div>
    </div>

    <div class="sidebar">
        <h3>Questions Palette</h3>
        <div class="palette-grid" id="palette-grid"></div>
    </div>
</div>

<div id="result-screen" class="hidden">
    <h2>Exam Summary</h2>
    <table>
        <tr><th>Total Questions</th><td id="sum-total">0</td></tr>
        <tr><th>Attempted</th><td id="sum-attempted">0</td></tr>
        <tr><th>Review</th><td id="sum-review">0</td></tr>
        <tr><th>Skipped</th><td id="sum-skipped">0</td></tr>
    </table>
    
    <p>Please enter your name to finalize submission:</p>
    <input type="text" id="student-name" placeholder="Full Name" style="padding:10px; width:200px;">
    <button class="btn btn-save" onclick="sendToGoogle()">Confirm Submission</button>
</div>

<script src="questions.js"></script>

<script>
    /* --- CONFIGURATION --- */
    const NEGATIVE_MARK = 0.25; 
    const POSITIVE_MARK = 1;
    
    // YOUR GOOGLE FORM IDs
    const FORM_ID = "1FAIpQLSfdc6KygQ100hICyXkaJYIWVJ7UxKYUw4aV22smmT3nRWCu3g"; 
    const ENTRY_NAME = "entry.1088098272";
    const ENTRY_SCORE = "entry.1899459571";
    const ENTRY_TIME = "entry.1956296565";

    /* --- LOGIC --- */
    let currentQIndex = 0;
    let userAnswers = {}; 
    let questionStatus = {}; 
    let timerInterval;
    let secondsElapsed = 0;

    window.onload = function() {
        // Check if questions loaded correctly
        if (typeof questions === 'undefined' || questions.length === 0) {
            alert("Error: 'questions.js' file not found or empty! Please check filename.");
            return;
        }
        initPalette();
        loadQuestion(0);
        startTimer();
    };

    function initPalette() {
        const grid = document.getElementById("palette-grid");
        grid.innerHTML = "";
        questions.forEach((q, index) => {
            const div = document.createElement("div");
            div.className = "palette-item";
            div.innerText = index + 1;
            div.id = `palette-${index}`;
            div.onclick = () => loadQuestion(index);
            grid.appendChild(div);
        });
    }

    function loadQuestion(index) {
        updateStatus(currentQIndex);
        currentQIndex = index;
        document.getElementById("q-number").innerText = currentQIndex + 1;
        document.getElementById("q-text").innerText = questions[currentQIndex].question;
        
        const optionsContainer = document.getElementById("options-container");
        optionsContainer.innerHTML = "";
        
        questions[currentQIndex].answers.forEach((ans, i) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <label>
                    <input type="radio" name="option" value="${i}" 
                    onclick="selectOption(${i})" 
                    ${userAnswers[currentQIndex] === i ? 'checked' : ''}>
                    ${ans.text}
                </label>
            `;
            optionsContainer.appendChild(li);
        });

        updatePaletteVisuals();
    }

    function selectOption(optionIndex) {
        userAnswers[currentQIndex] = optionIndex;
    }

    function saveAndNext() {
        if (userAnswers[currentQIndex] !== undefined) {
            questionStatus[currentQIndex] = "answered";
        } else {
            questionStatus[currentQIndex] = "not_answered";
        }
        moveNext();
    }

    function markReview() {
        questionStatus[currentQIndex] = "review";
        moveNext();
    }

    function clearResponse() {
        delete userAnswers[currentQIndex];
        const radios = document.getElementsByName("option");
        radios.forEach(r => r.checked = false);
        questionStatus[currentQIndex] = "visited"; 
    }

    function changeQuestion(step) {
        let newIndex = currentQIndex + step;
        if (newIndex >= 0 && newIndex < questions.length) {
            loadQuestion(newIndex);
        }
    }

    function moveNext() {
        if (currentQIndex < questions.length - 1) {
            loadQuestion(currentQIndex + 1);
        } else {
            updateStatus(currentQIndex);
            updatePaletteVisuals();
            alert("You are on the last question.");
        }
    }

    function updateStatus(index) {
        if (questionStatus[index] === "review") return; 
        if (userAnswers[index] !== undefined) {
            questionStatus[index] = "answered";
        } else {
            questionStatus[index] = "not_answered";
        }
    }

    function updatePaletteVisuals() {
        questions.forEach((_, i) => {
            const pItem = document.getElementById(`palette-${i}`);
            pItem.className = "palette-item"; 
            if (i === currentQIndex) pItem.classList.add("p-current");
            if (questionStatus[i] === "answered") pItem.classList.add("p-answered");
            else if (questionStatus[i] === "not_answered") pItem.classList.add("p-not_answered");
            else if (questionStatus[i] === "review") pItem.classList.add("p-review");
        });
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            secondsElapsed++;
            let m = Math.floor(secondsElapsed / 60);
            let s = secondsElapsed % 60;
            document.getElementById("timer").innerText = `${m}:${s < 10 ? '0'+s : s}`;
        }, 1000);
    }

    function submitQuiz() {
        clearInterval(timerInterval);
        document.getElementById("quiz-interface").classList.add("hidden");
        document.getElementById("result-screen").classList.remove("hidden");

        let attempted = 0;
        let reviewed = 0;
        questions.forEach((_, i) => {
            if (questionStatus[i] === "answered") attempted++;
            if (questionStatus[i] === "review") reviewed++;
        });

        document.getElementById("sum-total").innerText = questions.length;
        document.getElementById("sum-attempted").innerText = attempted;
        document.getElementById("sum-review").innerText = reviewed;
        document.getElementById("sum-skipped").innerText = questions.length - attempted - reviewed;
    }

    function sendToGoogle() {
        const name = document.getElementById("student-name").value;
        if (!name) { alert("Enter Name"); return; }

        let finalScore = 0;
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            if (userAnswer !== undefined) {
                if (q.answers[userAnswer].correct) finalScore += POSITIVE_MARK;
                else finalScore -= NEGATIVE_MARK;
            }
        });

        let timeTaken = document.getElementById("timer").innerText;
        const baseURL = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse?`;
        const submitURL = baseURL + 
            `${ENTRY_NAME}=${encodeURIComponent(name)}&` + 
            `${ENTRY_SCORE}=${finalScore}&` +
            `${ENTRY_TIME}=${encodeURIComponent(timeTaken)}&submit=Submit`;

        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.src = submitURL;
        document.body.appendChild(iframe);

        alert("Exam Submitted Successfully!");
        document.querySelector("#result-screen button").innerText = "Submitted";
        document.querySelector("#result-screen button").disabled = true;
    }
</script>

</body>
</html>
